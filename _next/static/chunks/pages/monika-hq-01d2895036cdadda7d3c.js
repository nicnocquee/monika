_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[15],{"7bRn":function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/monika-hq",function(){return t("Fz0i")}])},Fz0i:function(e,a,t){"use strict";t.r(a),t.d(a,"meta",(function(){return c})),t.d(a,"default",(function(){return m}));var n=t("wx14"),i=t("Ff2n"),o=t("q1tI"),r=t.n(o),l=t("7ljp"),b=t("er9C"),c=(r.a.createElement,{id:"monika-hq",title:"Monika-HQ"}),s={meta:c},p=function(e){var a=e.children,t=Object(i.a)(e,["children"]);return Object(l.b)(b.a,Object(n.a)({meta:c},t),a)};function m(e){var a=e.components,t=Object(i.a)(e,["components"]);return Object(l.b)(p,Object(n.a)({},s,t,{components:a,mdxType:"MDXLayout"}),Object(l.b)("p",null,Object(l.b)("inlineCode",{parentName:"p"},"monika-hq")," is a web app to manage multiple instances of Monika locally and remotely. "),Object(l.b)("blockquote",null,Object(l.b)("p",{parentName:"blockquote"},"To avoid confusion, please remember that Monika-HQ and Monika are different apps.")),Object(l.b)("img",{src:"/monika/monika-hq.png",alt:null}),Object(l.b)("h2",{id:"getting-started"},"Getting started",Object(l.b)("a",{parentName:"h2",href:"#getting-started",title:"Direct link to heading",className:"anchor"},Object(l.b)("span",{parentName:"a",className:"icon icon-link"}))),Object(l.b)("ol",null,Object(l.b)("li",{parentName:"ol"},"Install monika-hq: ",Object(l.b)("inlineCode",{parentName:"li"},"npm i -g @hyperjumptech/monika-hq")),Object(l.b)("li",{parentName:"ol"},"Run in port 8080: ",Object(l.b)("inlineCode",{parentName:"li"},"monika-hq -p 8080")),Object(l.b)("li",{parentName:"ol"},"Open browser and go to http://<IP_OF_MONIKA_HQ>:8080"),Object(l.b)("li",{parentName:"ol"},"If first time, ask for email and password."),Object(l.b)("li",{parentName:"ol"},"Create a Monika API Key. Provide a ",Object(l.b)("inlineCode",{parentName:"li"},"name")," and then click ",Object(l.b)("inlineCode",{parentName:"li"},"Generate"),".")),Object(l.b)("p",null,"Next, we need to run Monika with the ",Object(l.b)("inlineCode",{parentName:"p"},"monika-hq"),"'s URL and the generated key as follows."),Object(l.b)("ol",null,Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"Update Monika's config.json with the generated key as follows"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-json"},'{\n    "monika-hq": {\n        "url": "MONIKA_HQ_URL",\n        "key": "GENERATED_KEY"\n    }\n}\n'))),Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"Run ",Object(l.b)("inlineCode",{parentName:"p"},"monika -c config.json"),"."))),Object(l.b)("p",null,"Now Monika will regularly send reports to Monika-HQ. Then you can see the report from the Monika-HQ web app."),Object(l.b)("h2",{id:"features"},"Features",Object(l.b)("a",{parentName:"h2",href:"#features",title:"Direct link to heading",className:"anchor"},Object(l.b)("span",{parentName:"a",className:"icon icon-link"}))),Object(l.b)("h3",{id:"probes-list"},"Probes List",Object(l.b)("a",{parentName:"h3",href:"#probes-list",title:"Direct link to heading",className:"anchor"},Object(l.b)("span",{parentName:"a",className:"icon icon-link"}))),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Show list of probes from all Monika instances",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Filter by Monika instance"),Object(l.b)("li",{parentName:"ul"},"Same Probe's URL is shown once. "),Object(l.b)("li",{parentName:"ul"},"Search by URL"),Object(l.b)("li",{parentName:"ul"},"Shows the status of each probes (healthy or unhealthy)"))),Object(l.b)("li",{parentName:"ul"},"Enable or disable a probe")),Object(l.b)("h3",{id:"probes-status--report"},"Probe's Status / Report",Object(l.b)("a",{parentName:"h3",href:"#probes-status--report",title:"Direct link to heading",className:"anchor"},Object(l.b)("span",{parentName:"a",className:"icon icon-link"}))),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Show response time of the probe: average, slowest, fastest."),Object(l.b)("li",{parentName:"ul"},"Uptime/Downtime in percentage."),Object(l.b)("li",{parentName:"ul"},"Response time graph for the last two weeks. There is a dropdown to select which instance to display."),Object(l.b)("li",{parentName:"ul"},"Latest failed checks: date, time, duration, and the Monika instance"),Object(l.b)("li",{parentName:"ul"},"Sent notifications list."),Object(l.b)("li",{parentName:"ul"},"Change probe's request: URL, method, headers"),Object(l.b)("li",{parentName:"ul"},"Change probe's interval"),Object(l.b)("li",{parentName:"ul"},"Change probe's trueThreshold and falseThreshold")),Object(l.b)("h3",{id:"monika-api-keys"},"Monika API Keys",Object(l.b)("a",{parentName:"h3",href:"#monika-api-keys",title:"Direct link to heading",className:"anchor"},Object(l.b)("span",{parentName:"a",className:"icon icon-link"}))),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Create new key"),Object(l.b)("li",{parentName:"ul"},"Disable a key"),Object(l.b)("li",{parentName:"ul"},"Delete a key"),Object(l.b)("li",{parentName:"ul"},"Show list of keys: Instances of Monika that are using the key and when it was last used.")),Object(l.b)("h3",{id:"monika-instances"},"Monika Instances",Object(l.b)("a",{parentName:"h3",href:"#monika-instances",title:"Direct link to heading",className:"anchor"},Object(l.b)("span",{parentName:"a",className:"icon icon-link"}))),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Show list of connected Monika instances"),Object(l.b)("li",{parentName:"ul"},"Configure an instance of Monika:",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Update notification settings"),Object(l.b)("li",{parentName:"ul"},"Add notification"),Object(l.b)("li",{parentName:"ul"},"Remove/disable notification")))),Object(l.b)("h3",{id:"user-management"},"User management",Object(l.b)("a",{parentName:"h3",href:"#user-management",title:"Direct link to heading",className:"anchor"},Object(l.b)("span",{parentName:"a",className:"icon icon-link"}))),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Add or remove user that can access monika-hq."),Object(l.b)("li",{parentName:"ul"},"Change email or password of user.")),Object(l.b)("h2",{id:"how-it-works"},"How it works",Object(l.b)("a",{parentName:"h2",href:"#how-it-works",title:"Direct link to heading",className:"anchor"},Object(l.b)("span",{parentName:"a",className:"icon icon-link"}))),Object(l.b)("h3",{id:"handshake"},"Handshake",Object(l.b)("a",{parentName:"h3",href:"#handshake",title:"Direct link to heading",className:"anchor"},Object(l.b)("span",{parentName:"a",className:"icon icon-link"}))),Object(l.b)("blockquote",null,Object(l.b)("p",{parentName:"blockquote"},"This sections is a proposal on how to implement Monika-HQ. It won't be shown in the Monika's doc.")),Object(l.b)("p",null,'When Monika is started with the "monika-hq" key in the config.json, it will '),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"call ",Object(l.b)("inlineCode",{parentName:"p"},"<MONIKA_HQ_URL>/api/handshake")," end point with"),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"HTTP method: POST")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"Body:"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-json"},'{\n    "monika": {\n        "id": "some_uuid",\n        "ip_address": "this-instance-ip"\n    },\n    "data": {\n        "probes": [\n            // probes\n        ],\n        "notifications": [\n            // notifications\n        ]\n    }\n}\n'))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"Header:"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre"},"headers: {\n    Authorization: Bearer <API_KEY>\n}\n"))))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"monika-hq saves the received configuration and returns a unique string as a new config's version string:"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-json"},'{\n    "result": "ok",\n    "data": {\n        "config-version": "some string"\n    }\n}\n'))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"monika keeps this version string around and send it to monika-hq when it performs the Report Flow as explained below."))),Object(l.b)("h3",{id:"report-flow"},"Report Flow",Object(l.b)("a",{parentName:"h3",href:"#report-flow",title:"Direct link to heading",className:"anchor"},Object(l.b)("span",{parentName:"a",className:"icon icon-link"}))),Object(l.b)("p",null,'When Monika is started with the "monika-hq" key in the config.json, it will regularly (default every 3 minutes) perform the Report Flow as follows'),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"create an archive of the data since last report ")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"calls ",Object(l.b)("inlineCode",{parentName:"p"},"<MONIKA_HQ_URL>/api/report")," end point with "),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"HTTP method: POST")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"Content type: ",Object(l.b)("inlineCode",{parentName:"p"},"multipart/form-data"))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"Body:"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-json"},'{\n    "monika": {\n        "id": "some_uuid",\n        "ip_address": "this-instance-ip",\n        "config-version": "version-string"\n    },\n}\n'))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"Attachments: archive of the events data")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"Header:"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre"},"headers: {\n    Authorization: Bearer <API_KEY>\n}\n"))))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"monika-hq saves the events data to database then compares the received configuration's version. If the config's version is the same, monika-hq sends the following response"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-json"},'{\n    "result": "ok"\n}\n')),Object(l.b)("p",{parentName:"li"},"  If the configuration is different (user has changed say URL, notifications, etc from the Monika-HQ web app), it will send a response:"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",{parentName:"pre",className:"language-json"},'{\n    "result": "updated",\n    "data": {\n        "config-version": "new-version",\n        "probes": [\n            // new probes\n        ],\n        "notifications": [\n            // new notifications\n        ]\n    }\n}\n'))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"Monika then will update its own configuration if needed."))),Object(l.b)("img",{src:"/monika/monika-hq-how-it-works.png",alt:null}),Object(l.b)("h3",{id:"on-incidentrecovery"},"On Incident/Recovery",Object(l.b)("a",{parentName:"h3",href:"#on-incidentrecovery",title:"Direct link to heading",className:"anchor"},Object(l.b)("span",{parentName:"a",className:"icon icon-link"}))),Object(l.b)("p",null,"When an incident occurs, e.g., ",Object(l.b)("inlineCode",{parentName:"p"},"status-not-2xx"),' is triggered 5 times (or the threshhold) in a row, and Monika is started with the "monika-hq" key in the config.json, Monika will call the ',Object(l.b)("inlineCode",{parentName:"p"},"<MONIKA_HQ_URL>/api/report")," end point just like how it goes in the regular report cycle."),Object(l.b)("p",null,"Same goes when a probe recovers from incident."),Object(l.b)("h3",{id:"housekeeping"},"Housekeeping",Object(l.b)("a",{parentName:"h3",href:"#housekeeping",title:"Direct link to heading",className:"anchor"},Object(l.b)("span",{parentName:"a",className:"icon icon-link"}))),Object(l.b)("p",null,"Monika-hq regularly checks the saved Monika instances and automatically disables the instance that hasn't sent report data in the last 5 minutes. It may be because the instance is terminated in the remote server."),Object(l.b)("p",null,"When an instance is disabled,"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"the probes are removed from the dashboard."),Object(l.b)("li",{parentName:"ul"},"send email to registered users.")))}m.isMDXComponent=!0}},[["7bRn",0,2,4,1,3,5]]]);